<div class="crud-form" ng-init="loadPageTop();viewPurchaseReq();">


    <div class="margn-top30">

        <div class="row">

            <div class="col-md-6 col-lg-6" >

                <div class="panel panel-default">
                    <div class="panel-heading">Purchase Details & Location </div>
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table">

                                <tbody>
                                <tr>
                                    <td>Client</td>
                                    <td>{{purchaseReqObj.projectName}}</td>
                                </tr>
                                <tr>
                                    <td>Site</td>
                                    <td>{{purchaseReqObj.siteName}}</td>
                                </tr>
                                <tr>
                                    <td>PurchaseRef Number</td>
                                    <td>{{purchaseReqObj.purchaseRefGenNumber}}</td>

                                </tr>
                                <tr>
                                    <td>Status</td>
                                    <td>{{purchaseReqObj.requestStatus}}</td>

                                </tr>
                                <tr>
                                    <td>Purpose</td>
                                    <td ng-if="purchaseReqObj.purpose">{{purchaseReqObj.purpose}}</td>
                                    <td ng-if="!purchaseReqObj.purpose">-</td>

                                </tr>
                                <tr>
                                    <td>P.O Number</td>
                                    <td ng-if="purchaseReqObj.requestStatus == 'APPROVED' || purchaseReqObj.requestStatus =='PURCHASERAISED' || purchaseReqObj.requestStatus == 'REJECTED'" >
                                        <form ng-submit="updatePurchaseReq()" name="poForm" role="form">
                                            <div class="row" class="no-scroll">
                                                <div class="col-md-6">
                                                    <div class="form-group no-padding" >
                                                        <div class="dropdown">
                                                            <div class="form-group">
                                                                <input type="text" name="refNumber" class="form-control margn-top30" ng-model="purchaseReqObj.purchaseOrderNumber" required>
                                                                <div ng-show="poForm.$submitted || poForm.refNumber.$touched">
                                                                    <div ng-show="poForm.refNumber.$dirty || poForm.refNumber.$invalid">
                                                                        <p class="help-block" style="color: maroon"
                                                                           ng-show="poForm.refNumber.$error.required">P.O Number is
                                                                            required.
                                                                        </p>
                                                                        <p class="help-block" style="color: maroon"
                                                                           ng-show="poForm.refNumber.$error.required">P.O Number is
                                                                            required.
                                                                        </p>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <button type="submit" class="btn btn-success btn-sm margn-top35"  ng-model="purchaseReqObj.purchaseOrderNumber" ng-disabled="poForm.$invalid" >Add P.O.No</button>
                                                </div>
                                            </div>

                                        </form>
                                    </td>
                                    <td ng-if="purchaseReqObj.requestStatus != 'APPROVED' || purchaseReqObj.requestStatus !='PURCHASERAISED' || purchaseReqObj.requestStatus != 'REJECTED'">
                                        -
                                    </td>

                                </tr>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>

            <div class="col-md-6 col-lg-6" >

                <div class="panel panel-default" style="min-height:349px;">
                    <div class="panel-heading">Requester Details </div>
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table">

                                <tbody>
                                <tr>
                                    <td>Requester Id</td>
                                    <td>{{purchaseReqObj.requestedById}}</td>
                                </tr>
                                <tr>
                                    <td>Requester Name</td>
                                    <td>{{purchaseReqObj.requestedByName}}</td>

                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>

            <div class="col-md-12 col-lg-12">
                <form name="form" role="form" novalidate>
                    <div class="panel panel-default">
                        <div class="panel-heading">Item Details</div>
                        <div class="panel-body TableListinput">


                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                    <tr>
                                        <th>Item Code</th>
                                        <th>Item Name</th>
                                        <th>Uom</th>
                                        <th>Required Qty</th>
                                        <th>Qty Approved</th>
                                        <th width="10%" ng-if="purchaseReqObj.requestStatus == 'APPROVED' || purchaseReqObj.requestStatus =='PURCHASERAISED' || purchaseReqObj.requestStatus == 'REJECTED'">Approved Qty</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="items in purchaseReqObj.items">
                                        <td>{{items.materialItemCode}} </td>
                                        <td>{{items.materialName}}</td>
                                        <td>{{items.materialUom}}</td>
                                        <td>{{items.quantity}}</td>
                                        <td ><span ng-if="items.approvedQty">{{items.approvedQty}}</span><span ng-if="!items.approvedQty">Nil</span></td>
                                        <td width="10%" ng-init="items.currentAprQty = items.approvedQty" ng-if="purchaseReqObj.requestStatus == 'APPROVED' || purchaseReqObj.requestStatus =='PURCHASERAISED' || purchaseReqObj.requestStatus == 'REJECTED'">
                                            <input type="number" class="form-control" ng-model="items.currentAprQty" ng-disabled="purchaseReqObj.requestStatus == 'APPROVED' || purchaseReqObj.requestStatus =='PURCHASERAISED' || purchaseReqObj.requestStatus == 'REJECTED'" name="currentAprQty"  ng-blur="validateNumber(items, items.currentAprQty)">
                                        </td>
                                    </tr>
                                    </tbody>
                                    <tfoot>
                                    <td colspan="3"></td>
                                    <td colspan="3" class="text-right">
                                        <button class="btn btn-success" ng-show="purchaseReqObj.requestStatus === 'PENDING'" ng-click="conform('APPROVED',null,'update')"  type="button">
                                            Approve
                                        </button>
                                        <button class="btn btn-danger" type="button" ng-show="purchaseReqObj.requestStatus === 'PENDING'" ng-click="conform('REJECTED',null,'update')"  >
                                            Reject
                                            <div class="ripple-container"></div></button>
                                    </td>
                                    </tfoot>
                                </table>
                            </div>

                        </div>
                    </div>
                </form>


            </div>

        </div>
        <div class="row" id="approveButton">
            <div class="col-md-12 txt-align-rgt">
                <div class="form-group">

                    <button type="button" title="Approve Purchase Requisition" ng-if="items.approvedQty"
                             ng-click="conform('Approved',purchaseReqObj.id)"
                             class="btn btn-success">
                        <span class="btn-label"><i class="material-icons">done</i></span>
                        Approve
                    </button>

                    <button type="button" title="Reject Purchase Requisition" ng-if="items.approvedQty"
                             ng-click="conform('Rejected',purchaseReqObj.id)"
                             class="btn btn-danger">
                        <span class="btn-label"><i class="material-icons">done</i></span>
                        Reject
                    </button>

                    <button class="btn btn-default" type="button"
                            ng-click="conform('back')" id="cancel-button">
                        <i class="material-icons"></i> Back
                    </button>

                </div>
            </div>
        </div>


    </div>

</div>
